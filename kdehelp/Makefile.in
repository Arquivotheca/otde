#
# Makefile for kdehelp.   Good Luck
#

.SUFFIXES: .cpp

CXX = @CXX@
MOC = @MOC@
INCFLAGS = -I. @all_includes@ -I../kfm/libkfm -I.. -I../..
CXXFLAGS = -Wall 
LDFLAGS = @all_libraries@ -L../kfm/libkfm -lkfm -lkhtmlw -lkdeui -lkdecore -lqt -lXext -lX11 @LIBSOCKET@ @LIBCOMPAT@ -lgif -ljpeg
DEFS = -DHAVE_CONFIG_H

############# Install ##############

INSTALL = @INSTALL@ -m 0755
INSTALL_DATA = @INSTALL@ -m 0644
INSTALL_DIR = @INSTALL@ -d -m 0755

prefix = @prefix@
BINDIR = $(prefix)/bin
CGIDIR = $(prefix)/cgi-bin
LIBDIR = $(prefix)/lib
APPSDIR = $(LIBDIR)/apps
PICSDIR = $(LIBDIR)/pics
DOCSDIR = $(prefix)/doc/HTML

########## Implicit Rules ##########

.cpp.o:
	$(CXX) $(CXXFLAGS) $(INCFLAGS) $(DEFS) -c $<

########## Files ##########

SRCS = main.cpp help.cpp info.cpp error.cpp misc.cpp options.cpp\
		man.cpp bookmark.cpp cgi.cpp
SRCMETA = help.moc options.moc bookmark.moc cgi.moc
HDRS = help.h info.h error.h misc.h man.h options.h\
		bookmark.h dbnew.cpp cgi.h
OBJS = help.o main.o info.o error.o misc.o man.o options.o\
		bookmark.o dbnew.o cgi.o

TARGET = kdehelp

########## Build Rules ##########

all: $(TARGET) helpsearch helpindex

$(TARGET): $(SRCMETA) $(OBJS)
	$(CXX) -o $(TARGET) $(OBJS) $(LDFLAGS)

helpsearch:
	( cd search && $(MAKE) all) 
helpindex:
	( cd index && $(MAKE)  all)  

install:
	$(INSTALL_DIR) $(BINDIR)
	$(INSTALL) $(TARGET) $(BINDIR)
	(cd doc && $(MAKE) install)
	$(INSTALL_DIR) $(CGIDIR)
	$(INSTALL) search/helpsearch $(CGIDIR)
	$(INSTALL) index/helpindex $(CGIDIR)
	$(INSTALL_DIR) $(PICSDIR)
	$(INSTALL_DATA) pics/khtmlw_dnd.xpm $(PICSDIR)
	$(INSTALL_DATA) pics/stop.xpm $(PICSDIR)
	$(INSTALL_DATA) pics/stop_gray.xpm $(PICSDIR)

uninstall:
	rm -f $(BINDIR)/$(TARGET)
	(cd doc && $(MAKE) uninstall)
	rm -f $(CGIDIR)/helpsearch
	rm -f $(CGIDIR)/helpindex
	rm -f $(PICSDIR)/khtmlw_dnd.xpm
	rm -f $(PICSDIR)/stop.xpm
	rm -f $(PICSDIR)/stop_gray.xpm

clean:
	rm -f core *~ *.bak *.BAK $(SRCMETA) $(OBJS) $(TARGET)
	cd index ; $(MAKE) clean; cd ..
	cd search ; $(MAKE) clean; cd ..

depend: $(SRCS)
	@makedepend $(INCFLAGS) $(SRCS) 2> /dev/null

########## Meta objects ##########

%.moc: %.h
	$(MOC) $< -o $@

##################################
# DO NOT DELETE

