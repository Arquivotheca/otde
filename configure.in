# Original Author was Kalle@kde.org
# I lifted it in some mater. (Stephan Kulow)
# I used much code from Janos Farkas

dnl Process this file with autoconf to produce a configure script.

AC_INIT(acinclude.m4) dnl a source file from your sub dir
AC_MSG_WARN("This Code is alpha. It may not even compile.  Use at your own risk.")
AC_CANONICAL_SYSTEM 
AC_ARG_PROGRAM
AC_ISC_POSIX

dnl Automake doc recommends to do this only here. (Janos)
AM_INIT_AUTOMAKE(kdebase, 0.10) dnl searches for some needed programs

dnl make $KDEDIR the default for the installation
AC_PREFIX_DEFAULT(${KDEDIR:-/usr/local/kde})

dnl generate the config header
AM_CONFIG_HEADER(config.h) dnl at the distribution this done

dnl checks, if the debug code is wanted
AC_CHECK_FLAGS

dnl Checks for programs.
AC_PROG_CC
AC_PROG_CPP
test "$CCC" = "" && CCC="xlc DCC"
AC_PROG_CXX
AC_PROG_LN_S
AC_PROG_RANLIB dnl for libkfm

case $host in 
*-*-linux* )
   AC_CHECK_HEADER(elf.h, 
     [ 
     	AC_DEFINE(HAVE_SHADOW) 
	ac_have_shadow="yes"
     ])
esac

AC_ARG_ENABLE(setuid,[  --enable-setuid         enable setuid for kscreensavers [default=no]],
[ if test $enableval = "no"; 
    then ac_enable_setuid="no"
    else ac_enable_setuid="yes"
  fi
],
ac_enable_setuid="no"
)

if test "$SETUIDFLAGS" = ""; then 
 if test "$ac_enable_setuid" = "no"; then
  if test "$ac_have_shadow" = "yes"; then
    AC_WARN("You have shadow password! You should use --enable-setuid!")
  fi
  SETUIDFLAGS=""
 else
  SETUIDFLAGS="-m 4755"
 fi
else
 SETUIDFLAGS="-m $SETUIDFLAGS"
fi
AC_SUBST(SETUIDFLAGS)

AC_LANG_CPLUSPLUS
dnl Checks for libraries. 
AC_CHECK_LIB(socket, socket, [LIBSOCKET="-lsocket -lnsl"]) dnl for Solaris
AC_SUBST(LIBSOCKET)
AC_CHECK_LIB(compat, main, [LIBCOMPAT="-lcompat"]) dnl for FreeBSD
AC_SUBST(LIBCOMPAT)
AC_CHECK_LIB(crypt, main, [LIBCRYPT="-lcrypt"]) dnl for BSD
AC_SUBST(LIBCRYPT)
LIBKHTMLW="-lkhtmlw -ljscript" dnl this is somewhat historical, since jscript is ways needed
AC_SUBST(LIBKHTMLW)
AC_PATH_KDE 

AC_FIND_GIF
AC_FIND_JPEG
AC_PATH_PAM
AC_HAVE_GL(GL_SAVERS="kmorph3d.kss",GL_SAVERS="")
AC_SUBST(GL_SAVERS)
AC_HAVE_XPM(XPM_SAVERS="kbat.kss",XPM_SAVERS="")
AC_SUBST(XPM_SAVERS)

dnl Checks for header files.
AC_HEADER_DIRENT
AC_HEADER_STDC
AC_CHECK_HEADERS(fcntl.h sys/time.h unistd.h crypt.h sys/select.h \
	sys/ioctl.h termio.h termios.h lastlog.h malloc.h)

dnl Checks for typedefs, structures, and compiler characteristics.
AC_C_CONST
AC_C_INLINE
AC_HEADER_TIME

dnl check if the compiler has bool
AC_CHECK_BOOL
AC_C_LONG_DOUBLE

dnl Checks for library functions. MISCOBJS is for kdecore
AC_CHECK_FUNCS(socket powl sqrtl strdup getdtablesize)
AC_CHECK_KSIZE_T
AC_CHECK_SETENV

dnl output files
topdir=`pwd`
AC_SUBST(topdir)

dnl Perform program name transformation
AC_ARG_PROGRAM

AC_OUTPUT(Makefile \
	kpanel/Makefile \
	kdehelp/Makefile \
	kdehelp/doc/Makefile \
	kdehelp/index/Makefile \
	kdehelp/search/Makefile \
	kfm/Makefile \
	kfm/Desktop/Makefile \
	kfm/doc/Makefile \
	kfm/apps/Makefile \
	kfm/client/Makefile \
	kfm/kioslave/Makefile \
	kfm/pics/Makefile \
	kfm/kfmwarn/Makefile \
	kfm/mimetypes/Makefile \
	kdisplay/Makefile \
	kdisplay/doc/Makefile \
	kfind/Makefile \
	kfind/doc/Makefile \
	kfind/pics/Makefile \
	kfontmanager/Makefile \
	kfontmanager/docs/Makefile \
	klogout/Makefile \
	kpanel/apps/Makefile \
	kpanel/lib/pics/Makefile \
	kscreensaver/Makefile \
	kvt/Makefile \
	kwm/Makefile \
	kwm/doc/Makefile \
	kwm/pics/Makefile \
	kwmclient/Makefile \
	pics/Makefile)


