###################################
KFIND_VERSION = 0.3

INSTALL = @INSTALL@ -m 0755 
INSTALL_DIR = @INSTALL@ -d -m 0755 
INSTALL_DATA = @INSTALL@ -m 0644

prefix  = @prefix@
BINDIR  = $(prefix)/bin
LIBDIR  = $(prefix)/lib
PICSDIR = $(LIBDIR)/pics
DOCSDIR = $(prefix)/doc/HTML/

INCLDIR	= @all_includes@ -I..


CXXFLAGS= @CXXFLAGS@ -DKFIND_VERSION=\"$(KFIND_VERSION)\" -DDOCSDIR=\"$(DOCSDIR)/\" -DHAVE_CONFIG_H -I../kfm/libkfm
LDFLAGS	= @LDFLAGS@ @all_libraries@ -lkfm -lkdeui -lkdecore -lqt -lXext -lX11 @LIBSOCKET@ -L../kfm/libkfm
CXX 	= @CXX@
MOC 	= @MOC@

####### Files

SOURCES	  =  kfarch.cpp kfdird.cpp kfmenu.cpp  kftabdlg.cpp \
	     kfsave.cpp kftypes.cpp kfoptions.cpp kfwin.cpp kfind.cpp \
	     main.cpp 
OBJECTS	  =  kfarch.o kfdird.o kfmenu.o kftabdlg.o kfwin.o \
             kfsave.o kftypes.o kfoptions.o kfind.o main.o
SRCMETA   =  mkfdird.cpp mkfwin.cpp mkfmenu.cpp \
             mkftabdlg.cpp mkfoptions.cpp mkfind.cpp
OBJMETA   =  mkfdird.o mkfwin.o mkfmenu.o mkftabdlg.o \
             mkfoptions.o mkfind.o
TARGET	  =  kfind
HEADERS	  =  kfarch.h kfdird.h kfmenu.h kftabdlg.h kfwin.h kfind.h \
             kfsave.h kftypes.h kfoptions.h
DISTFILES =  $(SOURCES) $(HEADERS) $(TARGET) Makefile README LICENCE\
             .kde.html kfind.xpm kfind.kdelnk kfind.html ktabctl.patch kfindrc
DISTDIR   =  kfind-$(KFIND_VERSION)

####### Implicit rules

.SUFFIXES: .cpp

.cpp.o:
	$(CXX) -c $(CXXFLAGS) $(INCLDIR) $<

####### Build rules

all: $(TARGET)

Makefile: Makefile.in
	cd .. && CONFIG_FILES=kfind/$@ CONFIG_HEADERS= $(SHELL) ./config.status

$(TARGET): $(OBJECTS) $(OBJMETA)
	$(CXX) $(OBJECTS) $(OBJMETA) -o $(TARGET) $(LDFLAGS)

depend:
	@makedepend -I$(INCDIR) $(SOURCES) 2> /dev/null

showfiles:
	@echo $(SOURCES) Makefile

clean:
	-rm -f *.o *.bak *~ *% *.tar.gz #*
	-rm -f $(SRCMETA) $(TARGET)

install: all
	$(INSTALL_DIR) $(BINDIR)
	$(INSTALL) $(TARGET) $(BINDIR)
	$(INSTALL_DIR) $(PICSDIR)
	$(INSTALL_DATA) $(TARGET).xpm $(PICSDIR)
	$(INSTALL_DATA) kfind.html $(DOCSDIR)
	$(INSTALL_DIR) $(prefix)/apps/Utilities
	$(INSTALL_DATA) kfind.kdelnk $(prefix)/apps/Utilities
	$(INSTALL_DIR) $(LIBDIR)/kfind/config
	$(INSTALL_DATA) ./kfindrc $(LIBDIR)/kfind/config

uninstall:
	rm -f $(BINDIR)/$(TARGET)
	rm -f $(PICSDIR)/$(TARGET).xpm
	rm -f $(DOCSDIR)/kfind.html
	rm -f $(prefix)/apps/Utility/kfind.kdelnk
	rm -f $(LIBDIR)/kfind/config/kfindrc

dist:
	-mkdir $(DISTDIR)
	-mkdir $(DISTDIR)/filetypes
	for i in $(DISTFILES); do ln -f $$i $(DISTDIR)/$$i; done
	for i in ./filetypes/*; do ln -f $$i $(DISTDIR)/$$i; done
	tar czf $(DISTDIR).tar.gz $(DISTDIR)

####### Explicit dependencies


m%.cpp: %.h
	$(MOC) $< -o $@  

# DO NOT DELETE THIS LINE -- make depend depends on it.
