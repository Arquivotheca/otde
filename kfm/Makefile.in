####### KFM Makefile

INCDIR	=	@all_includes@  -I.. -I.
CXXFLAGS=	$(INCDIR) @CXXFLAGS@ -DHAVE_CONFIG_H
LDFLAGS	=	@all_libraries@ -lqt -lXext -lX11 -lkdeui -lkdecore -lkhtmlw @LIBSOCKET@ -ljpeg -lgif -ljscript
CXX 	=	@CXX@
MOC	=	@MOC@

############# Install ##############

INSTALL = @INSTALL@ -m 0755 
INSTALL_SHELL = @INSTALL@ -m 0755
INSTALL_DATA = @INSTALL@ -m 0644
INSTALL_DIR = @INSTALL@ -d -m 0755
INSTALL_DIR_PRIVATE = @INSTALL@ -d -m 0700

prefix = @prefix@
KDEINC = $(prefix)/include
BINDIR = $(prefix)/bin
LIBDIR = $(prefix)/lib
DOCSDIR = $(prefix)/doc/HTML/kfm
DESKTOPDIR = $(HOME)/Desktop
TRASHDIR = $(HOME)/Trash
TEMPLATEDIR = $(DESKTOPDIR)/Templates

####### Files

SOURCES =	kfmgui.cpp kfmview.cpp kbind.cpp main.cpp kfmdlg.cpp bookmark.cpp kfmprops.cpp kfmserver_ipc.cpp kfmserver_ipc2.cpp kfmserver.cpp kioserver.cpp kioserver_ipc.cpp kioserver_ipc2.cpp ipc.cpp root.cpp kfmman.cpp kiojob.cpp kmsgwin.cpp htmlcache.cpp autostart.cpp kfmtree.cpp xview.cpp krenamewin.cpp passworddialog.cpp cgi.cpp fileentry.cpp
HEADERS =	kfmgui.h kfmview.h kbind.h root.h kfmdlg.h bookmark.h kfmprops.h kfmserver_ipc.h kioserver.h kioserver_ic.h ipc.h kfmserver.h kfmman.h kiojob.h kmsgwin.h htmlcache.h kfmtree.h xview.h krenamewin.h passworddialog.h cgi.h fileentry.h
OBJECTS =	kfmgui.o kfmview.o kbind.o root.o main.o kfmdlg.o bookmark.o kfmprops.o kfmserver_ipc.o kfmserver_ipc2.o kfmserver.o kioserver.o kioserver_ipc.o kioserver_ipc2.o ipc.o kfmman.o kiojob.o kmsgwin.o htmlcache.o autostart.o kfmtree.o xview.o krenamewin.o passworddialog.o cgi.o fileentry.o debug.o
SRCMETA =	kfmgui.moc kfmview.moc root.moc kfmdlg.moc bookmark.moc kfmprops.moc kfmserver_ipc.moc kfmserver.moc kioserver.moc kioserver_ipc.moc kfmman.moc kiojob.moc kmsgwin.moc htmlcache.moc kfmtree.moc krenamewin.moc passworddialog.moc cgi.moc fileentry.moc
TARGET	=	kfm

####### Implicit rules

.SUFFIXES: .cpp

.cpp.o:
	$(CXX) -c $(CXXFLAGS) $<

%.moc: %.h
	$(MOC) $< -o $@      

####### Build rules

all: kwarn kfmclient slave $(TARGET)

Makefile: Makefile.in
	cd .. && CONFIG_FILES=kfm/$@ CONFIG_HEADERS= $(SHELL) ./config.status 

kwarn:
	( cd kfmwarn ; $(MAKE) all )

slave:
	( cd kioslave && $(MAKE) all )

kfmclient:
	( cd client ; $(MAKE) all ) 

$(TARGET): $(SRCMETA) $(OBJECTS)
	$(CXX) $(OBJECTS) -o $(TARGET) $(LDFLAGS)

debug.o: config-kfm.h

depend:
	@makedepend $(INCDIR) $(SOURCES) 2> /dev/null

showfiles:
	@echo $(SOURCES) $(HEADERS) Makefile

cleanroot:
	-rm -f *.o *.bak *~ *% #*
	-rm -f $(SRCMETA) $(TARGET)

clean: cleanroot

	(cd client; $(MAKE) clean)
	(cd kioslave; $(MAKE) clean)
	(cd kfmwarn && $(MAKE) clean)

install: all
	$(INSTALL_DIR) $(BINDIR)
	$(INSTALL_DIR) $(LIBDIR)
	$(INSTALL) $(TARGET) $(BINDIR)
	$(INSTALL) ./kioslave/kioslave $(BINDIR)
	$(INSTALL) ./kfmwarn/kfmwarn $(BINDIR)
	$(INSTALL) ./client/kfmclient $(BINDIR)
	$(INSTALL_DATA) ./unpack $(BINDIR)
	(cd doc && $(MAKE) install)
	(cd pics && $(MAKE) install)
	$(INSTALL_DIR) $(LIBDIR)/kfm/config
	$(INSTALL_DATA) config/kfmrc $(LIBDIR)/kfm/config
	$(INSTALL_DATA) config/desktop $(LIBDIR)/kfm/config
	(cd Desktop && $(MAKE) install)
	(cd mimetypes && $(MAKE) install)

IPC:    clientIPC kioIPC

clientIPC: ./ipcc/kfm.ipc
	cd ipcc ; ./ipcc.pl kfm.ipc kfmserver_ipc kfmclient_ipc ; cp kfmserver_ipc* ../ ; cp kfmclient_ipc* ../client ; cd ..

kioIPC: ./ipcc/kio.ipc
	cd ipcc ; ./ipcc.pl kio.ipc kioserver_ipc kioslave_ipc ; cp kioserver_ipc* ../ ; cp kioslave_ipc* ../kioslave ; cd ..


# DO NOT DELETE THIS LINE -- make depend depends on it.
