#
#                           kppp Makefile
#
#  Copyright 1997 Bernd Johannes Wuebben, wuebben@math.cornell.edu
#
#  $Id$
#

kde_libraries = @kde_libraries@
qt_libraries = @qt_libraries@
top_builddir = ..
LIBTOOL = @LIBTOOL@
KDE_RPATH = @KDE_RPATH@
SHELL = /bin/sh

CXXFLAGS= @CXXFLAGS@ @all_includes@ -DHAVE_CONFIG_H  -I.. -I.
LDFLAGS	= @LDFLAGS@ @all_libraries@  -lkdeui -lkdecore  -lqt \
	  -lXext -lX11 @LIBSOCKET@ 
CXX     = @CXX@
MOC   	= @MOC@

############# INSTALL #################

INSTALL = @INSTALL@ -m 0755
INSTALL_DATA = @INSTALL@ -m 0644
INSTALL_DIR = @INSTALL@ -d -m 0755
INSTALL_DIR_PRIVATE = @INSTALL@ -d -m 0700

prefix = @prefix@
KDEINC = $(prefix)/include
BINDIR = $(prefix)/bin
LIBDIR = $(prefix)/lib
PICSDIR = $(prefix)/share/apps/kppp/pics/
ICONSDIR = $(prefix)/share/icons
DOCSDIR = $(prefix)/share/doc/HTML/en/kppp
APPLNKDIR = $(prefix)/share/applnk/Internet
RULESDIR = $(prefix)/share/apps/kppp/Rules

########### File Formats ###########

# Uncoment this is you want kppp to give you more 
DEFS =  #-DMY_DEBUG 

.SUFFIXES: .cpp

.cpp.o:
	$(CXX) $(DEFS) -c $(CXXFLAGS) $<

%.moc: %.h
	$(MOC) $< -o $@

########## Files #####################

SOURCES =	accounts.cpp \
		connect.cpp \
		conwindow.cpp \
		debug.cpp \
		edit.cpp \
		general.cpp \
		iplined.cpp \
		main.cpp \
		modemcmds.cpp \
		pppdargs.cpp \
		pppdata.cpp \
		scriptedit.cpp\
		pwentry.cpp \
		modeminfo.cpp\
		pppstatdlg.cpp\
		pppstats.cpp\
		miniterm.cpp\
		accounting.cpp \
		acctselect.cpp\
		ruleset.cpp \
		homedir.cpp

HEADERS =	accounts.h \
		config.h \
		connect.h \
		conwindow.h \
		debug.h \
		edit.h \
		general.h \
		iplined.h \
		main.h \
		modemcmds.h \
		pppdargs.h \
		pppdata.h \
		scriptedit.h\
		pwentry.h \
		modeminfo.h\
		pppstatdlg.h\
		miniterm.h\
		accounting.h \
		acctselect.h\
		ruleset.h \
		homedir.h

OBJECTS =	accounts.o \
		connect.o \
		conwindow.o \
		debug.o \
		edit.o \
		general.o \
		iplined.o \
		main.o \
		modemcmds.o \
		pppdargs.o \
		pppdata.o \
		scriptedit.o\
		pwentry.o\
		modeminfo.o\
		pppstatdlg.o\
		pppstats.o\
		miniterm.o\
		accounting.o\
		acctselect.o\
		ruleset.o\
		homedir.o

SRCMETA =	accounts.moc \
		connect.moc \
		conwindow.moc \
		debug.moc \
		edit.moc \
		general.moc \
		main.moc \
		modemcmds.moc \
		pppdargs.moc \
		scriptedit.moc\
		pwentry.moc\
		modeminfo.moc\
		pppstatdlg.moc\
		miniterm.moc\
		accounting.moc\
		acctselect.moc

TARGET	=	kppp


######### build rules ################

all: $(TARGET)

Makefile: Makefile.in
	cd .. && CONFIG_FILES=kppp/$@ CONFIG_HEADERS= $(SHELL) ./config.status

$(TARGET): $(SRCMETA) $(OBJECTS)
	$(LIBTOOL) --mode=link $(CXX) $(OBJECTS) -o $(TARGET) $(LDFLAGS) $(KDE_RPATH)

depend:
	@makedepend $(SOURCES) 2> /dev/null

showfiles:
	@echo $(SOURCES) $(HEADERS) Makefile

clean:
	rm -f *.o *.bak *~ *% #*
	rm -f $(SRCMETA) $(TARGET)

distclean: clean
	rm -f Makefile

install: $(TARGET)
	$(INSTALL_DIR) $(BINDIR)
	$(INSTALL) $(TARGET) $(BINDIR)
	$(INSTALL_DIR) $(DOCSDIR)
	$(INSTALL_DATA) docs/k* $(DOCSDIR)
	$(INSTALL_DATA) docs/*.gif $(DOCSDIR)	
	$(INSTALL_DATA) docs/hayes.html $(DOCSDIR)
	$(INSTALL_DIR) $(PICSDIR)
	$(INSTALL_DATA) ./pixmaps/*.xpm $(PICSDIR)
	$(INSTALL_DIR) $(ICONSDIR)
	$(INSTALL_DATA) ./pixmaps/kppp.xpm $(ICONSDIR)
	$(INSTALL_DATA) ./pixmaps/mini-kppp.xpm $(ICONSDIR)/mini/kppp.xpm
	$(INSTALL_DIR) $(APPLNKDIR)	
	$(INSTALL_DATA) Kppp.kdelnk $(APPLNKDIR)
	$(INSTALL_DIR) $(RULESDIR)
	$(INSTALL_DIR) $(RULESDIR)/Austria
	$(INSTALL_DIR) $(RULESDIR)/Austria/Business_1
	$(INSTALL_DATA) ./Rules/Austria/Business_1/*.rst $(RULESDIR)/Austria/Business_1
	$(INSTALL_DIR) $(RULESDIR)/Austria/Business_2
	$(INSTALL_DATA) ./Rules/Austria/Business_2/*.rst $(RULESDIR)/Austria/Business_2
	$(INSTALL_DIR) $(RULESDIR)/Austria/Minimum
	$(INSTALL_DATA) ./Rules/Austria/Minimum/*.rst $(RULESDIR)/Austria/Minimum
	$(INSTALL_DIR) $(RULESDIR)/Austria/Standard
	$(INSTALL_DATA) ./Rules/Austria/Standard/*.rst $(RULESDIR)/Austria/Standard
	$(INSTALL_DIR) $(RULESDIR)/England
	$(INSTALL_DATA) ./Rules/England/*.rst $(RULESDIR)/England
	$(INSTALL_DIR) $(RULESDIR)/France
	$(INSTALL_DATA) ./Rules/France/*.rst $(RULESDIR)/France
	$(INSTALL_DIR) $(RULESDIR)/Germany
	$(INSTALL_DATA) ./Rules/Germany/*.rst $(RULESDIR)/Germany
	$(INSTALL_DIR) $(RULESDIR)/Greece
	$(INSTALL_DATA) ./Rules/Greece/*.rst $(RULESDIR)/Greece
	$(INSTALL_DIR) $(RULESDIR)/Hungary
	$(INSTALL_DATA) ./Rules/Hungary/*.rst $(RULESDIR)/Hungary
	$(INSTALL_DIR) $(RULESDIR)/Italy
	$(INSTALL_DATA) ./Rules/Italy/*.rst $(RULESDIR)/Italy
	$(INSTALL_DIR) $(RULESDIR)/Netherlands
	$(INSTALL_DATA) ./Rules/Netherlands/*.rst $(RULESDIR)/Netherlands
	$(INSTALL_DIR) $(RULESDIR)/Norway
	$(INSTALL_DATA) ./Rules/Norway/*.rst $(RULESDIR)/Norway
	$(INSTALL_DIR) $(RULESDIR)/Poland
	$(INSTALL_DATA) ./Rules/Poland/*.rst $(RULESDIR)/Poland
	$(INSTALL_DIR) $(RULESDIR)/Portugal
	$(INSTALL_DATA) ./Rules/Portugal/*.rst $(RULESDIR)/Portugal
	$(INSTALL_DIR) $(RULESDIR)/Spain
	$(INSTALL_DATA) ./Rules/Spain/*.rst $(RULESDIR)/Spain
	$(INSTALL_DIR) $(RULESDIR)/Sweden
	$(INSTALL_DATA) ./Rules/Sweden/*.rst $(RULESDIR)/Sweden
	$(INSTALL_DATA) ./Rules/TEMPLATE $(DOCSDIR)
	chmod u+s $(BINDIR)/kppp
	@echo ""
	@echo "Dont't forget to send me a phone tarif rules file for your"
	@echo "telecom company/country/region. Thanks."
	@echo ""
	@echo "I am mainting an archive on the kppp page at"
	@echo "http://math.cornell.edu/~wuebben/kde.html"
	@echo "WARNING: kppp is by default installed with SETUID bit on!"
	@echo  "If you are concerned about the SETUID bit, create a modem"
	@echo "group instead."
	@echo ""
	@echo "Happy Dialing! -- Bernd Wuebben"
	@echo ""

messages:
	@XGETTEXT@ -C -ktranslate -x ../../kdelibs/po/kde.pot $(SOURCES) &&  mv messages.po ../po/kppp.pot

uninstall:
	rm -f $(BINDIR)/$(TARGET)
#	rm -f $(DOCSDIR)/kppp.html
#	rm -f $(DOCSDIR)/kppp.gif
#	rm -f $(APPSDIR)/Applications/kppp.kdelnk
